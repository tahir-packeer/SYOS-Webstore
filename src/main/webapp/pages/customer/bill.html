<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Receipt</title>
    <link rel="icon" href="data:," />
    <style>
      /* Simple Black and White Design */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: white;
        color: black;
        line-height: 1.6;
      }

      .navbar {
        background: white;
        border-bottom: 2px solid black;
        padding: 1rem 2rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .navbar-brand {
        font-size: 1.8rem;
        font-weight: 700;
        color: black;
        text-decoration: none;
      }

      .navbar-nav {
        display: flex;
        gap: 0.5rem;
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .navbar-nav li {
        margin: 0;
      }

      .navbar-nav li a {
        display: block;
        color: black;
        text-decoration: none;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .navbar-nav li a:hover,
      .navbar-nav li a.active {
        background: black;
        color: white;
        border: 2px solid black;
      }

      .navbar-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .user-info {
        color: black;
        font-weight: 500;
      }

      .btn {
        background: white;
        color: black;
        border: 2px solid black;
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .btn:hover {
        background: black;
        color: white;
      }

      .main-content {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        border: 2px solid black;
        background: white;
      }

      .receipt-header {
        background: black;
        color: white;
        padding: 2rem;
        text-align: center;
        margin: -2rem -2rem 2rem -2rem;
      }

      .success-badge {
        background: #28a745;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        display: inline-block;
        margin-bottom: 1rem;
      }

      .invoice-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
      }

      .invoice-item {
        border: 2px solid black;
        padding: 1rem;
        text-align: center;
      }

      .invoice-item strong {
        display: block;
        margin-bottom: 0.5rem;
      }

      .items-table {
        width: 100%;
        border-collapse: collapse;
        margin: 2rem 0;
      }

      .items-table th,
      .items-table td {
        border: 1px solid black;
        padding: 0.75rem;
        text-align: left;
      }

      .items-table th {
        background: black;
        color: white;
      }

      .summary-section {
        border: 2px solid black;
        padding: 1rem;
        margin: 2rem 0;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin: 0.5rem 0;
      }

      .summary-total {
        font-weight: bold;
        font-size: 1.2rem;
        border-top: 2px solid black;
        padding-top: 0.5rem;
        margin-top: 1rem;
      }

      .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin: 2rem 0;
      }

      @media print {
        .navbar,
        .action-buttons {
          display: none;
        }
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
          gap: 1rem;
          padding: 0 1rem;
        }

        .navbar-nav {
          flex-wrap: wrap;
          justify-content: center;
          gap: 0.5rem;
        }

        .navbar-actions {
          gap: 0.5rem;
        }

        .invoice-grid {
          grid-template-columns: 1fr;
        }

        .main-content {
          margin: 1rem;
          padding: 1rem;
        }

        .action-buttons {
          flex-direction: column;
          gap: 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container">
        <a href="catalog.html" class="navbar-brand">SYOS Webstore</a>
        <ul class="navbar-nav">
          <li><a href="catalog.html">Browse</a></li>
        </ul>
        <div class="navbar-actions">
          <span class="user-info" id="userInfo">Guest</span>
          <button class="btn" onclick="handleAuth()" id="authButton">
            Login
          </button>
        </div>
      </div>
    </nav>

    <!-- Bill Content -->
    <div class="main-content">
      <div class="receipt-header">
        <div class="success-badge">PAYMENT SUCCESSFUL</div>
        <h1>PAYMENT RECEIPT</h1>
        <h2>SYOS MANAGEMENT</h2>
      </div>

      <!-- Invoice Details -->
      <div class="invoice-grid">
        <div class="invoice-item">
          <strong>Invoice Number:</strong>
          <span id="invoiceNumber">INV-00012345</span>
        </div>
        <div class="invoice-item">
          <strong>Date:</strong>
          <span id="billDate">Loading...</span>
        </div>
        <div class="invoice-item">
          <strong>Time:</strong>
          <span id="billTime">Loading...</span>
        </div>
        <div class="invoice-item">
          <strong>Payment Method:</strong>
          <span>Online</span>
        </div>
      </div>

      <!-- Customer Details -->
      <div style="border: 2px solid black; padding: 1rem; margin: 2rem 0">
        <h3 style="margin-bottom: 1rem">CUSTOMER DETAILS</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
          <div>
            <strong>Name:</strong> <span id="customerName">John Customer</span>
          </div>
          <div>
            <strong>Phone:</strong> <span id="customerPhone">0771234567</span>
          </div>
          <div>
            <strong>Email:</strong>
            <span id="customerEmail">john@example.com</span>
          </div>
          <div>
            <strong>Customer ID:</strong> <span id="customerId">CUST001</span>
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <h3>ITEMS PURCHASED</h3>
      <table class="items-table">
        <thead>
          <tr>
            <th>ITEM CODE</th>
            <th>DESCRIPTION</th>
            <th>QUANTITY</th>
            <th>UNIT PRICE</th>
            <th>TOTAL</th>
          </tr>
        </thead>
        <tbody id="itemsTableBody">
          <tr>
            <td colspan="5" style="text-align: center; padding: 2rem">
              Loading items...
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Payment Summary -->
      <div class="summary-section">
        <h3 style="margin-bottom: 1rem">PAYMENT SUMMARY</h3>
        <div class="summary-row">
          <span>Subtotal:</span>
          <span id="subtotalAmount">LKR 0.00</span>
        </div>
        <div class="summary-row">
          <span>Discount:</span>
          <span id="discountAmount">LKR 0.00</span>
        </div>
        <div class="summary-row summary-total">
          <span>Total Paid:</span>
          <span id="totalAmount">LKR 0.00</span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn" onclick="window.print()">Print Receipt</button>
        <button class="btn" onclick="downloadPDF()">Download PDF</button>
        <button class="btn" onclick="emailReceipt()">Email Receipt</button>
        <button class="btn" onclick="continueShopping()">
          Continue Shopping
        </button>
      </div>
    </div>

    <script src="../../js/utils.js"></script>
    <script>
      // Simple and Working Bill Page
      let billData = {};

      document.addEventListener("DOMContentLoaded", function () {
        loadBillData();
        populateData();
      });

      function loadBillData() {
        // Try to get data from sessionStorage
        const storedData = sessionStorage.getItem("billData");

        if (storedData) {
          try {
            billData = JSON.parse(storedData);
            console.log("Loaded bill data:", billData);
          } catch (e) {
            console.log("Error parsing stored data, using sample");
            createSampleData();
          }
        } else {
          console.log("No stored data, creating sample");
          createSampleData();
        }
      }

      function createSampleData() {
        billData = {
          response: {
            billId: 12345,
            invoiceNumber: "INV-00012345",
            total: 1450.0,
            finalTotal: 1380.0,
            discount: 70.0,
          },
          cartItems: [
            {
              code: "RICE001",
              name: "Basmati Rice 1kg",
              quantity: 2,
              price: 450.0,
            },
            {
              code: "TEA001",
              name: "Ceylon Black Tea 100g",
              quantity: 1,
              price: 580.0,
            },
            {
              code: "OIL001",
              name: "Coconut Oil 500ml",
              quantity: 1,
              price: 420.0,
            },
          ],
          user: {
            name: "John Customer",
            email: "john@example.com",
            phone: "0771234567",
            id: "CUST001",
          },
        };
      }

      function populateData() {
        // Current date/time
        const now = new Date();
        document.getElementById("billDate").textContent =
          now.toLocaleDateString();
        document.getElementById("billTime").textContent =
          now.toLocaleTimeString();

        // Invoice details
        if (billData.response) {
          document.getElementById("invoiceNumber").textContent =
            billData.response.invoiceNumber || "INV-00012345";
        }

        // Customer details
        if (billData.user) {
          document.getElementById("customerName").textContent =
            billData.user.name || "John Customer";
          document.getElementById("customerEmail").textContent =
            billData.user.email || "john@example.com";
          document.getElementById("customerPhone").textContent =
            billData.user.phone || "0771234567";
          document.getElementById("customerId").textContent =
            billData.user.id || "CUST001";
        }

        // Items table
        const tbody = document.getElementById("itemsTableBody");
        tbody.innerHTML = "";

        if (billData.cartItems && billData.cartItems.length > 0) {
          billData.cartItems.forEach((item) => {
            const row = document.createElement("tr");
            const total = (item.price * item.quantity).toFixed(2);
            row.innerHTML = `
              <td>${item.code}</td>
              <td>${item.name}</td>
              <td style="text-align: center;">${item.quantity}</td>
              <td style="text-align: right;">LKR ${item.price.toFixed(2)}</td>
              <td style="text-align: right; font-weight: bold;">LKR ${total}</td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML =
            '<tr><td colspan="5" style="text-align: center;">No items found</td></tr>';
        }

        // Summary
        if (billData.response) {
          const subtotal = billData.response.total || 0;
          const discount = billData.response.discount || 0;
          const finalTotal =
            billData.response.finalTotal || subtotal - discount;

          document.getElementById(
            "subtotalAmount"
          ).textContent = `LKR ${subtotal.toFixed(2)}`;
          document.getElementById(
            "discountAmount"
          ).textContent = `LKR ${discount.toFixed(2)}`;
          document.getElementById(
            "totalAmount"
          ).textContent = `LKR ${finalTotal.toFixed(2)}`;
        }

        console.log("Bill data populated successfully");
      }

      // Action functions
      function downloadPDF() {
        alert("PDF download feature will be implemented");
      }

      function emailReceipt() {
        alert("Email receipt feature will be implemented");
      }

      function continueShopping() {
        window.location.href = "catalog.html";
      }

      // Authentication handling
      function handleAuth() {
        const user = SessionManager.getUser();
        if (user) {
          // User is logged in, logout
          SessionManager.clearSession();
          window.location.href = "../../index.html";
        } else {
          // User is not logged in, redirect to login
          window.location.href = "../../index.html";
        }
      }

      // Update navbar based on login status
      function updateNavbar() {
        const user = SessionManager.getUser();
        const userInfo = document.getElementById("userInfo");
        const authButton = document.getElementById("authButton");

        if (user) {
          userInfo.textContent = user.name || user.email || "Customer";
          authButton.textContent = "Logout";
        } else {
          userInfo.textContent = "Guest";
          authButton.textContent = "Login";
        }
      }

      // Initialize navbar on page load
      document.addEventListener("DOMContentLoaded", function () {
        if (typeof SessionManager !== "undefined") {
          updateNavbar();
        }
      });
    </script>
  </body>
</html>
